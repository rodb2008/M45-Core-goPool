{{/* Shared layout pieces: header toolbar and footer */}}

{{define "header"}}
<header>
	<div class="header-inner">
		<div class="brand">
			<img src="/logo.png" alt="{{.BrandName}} logo" class="brand-logo">
			<div>
				{{if .BrandDomain}}
				<div class="brand-title">{{.BrandDomain}}</div>
				{{end}}
				{{if .ListenAddr}}
				<div class="brand-sub">
					stratum:{{addrPort .ListenAddr}}{{if .StratumTLSListen}} / tls:{{addrPort .StratumTLSListen}}{{end}}
				</div>
				{{end}}
				{{if .Tagline}}
				<div class="brand-sub">{{.Tagline}}</div>
				{{end}}
			</div>
		</div>
		<nav class="header-links">
			<button class="theme-toggle" id="themeToggle" type="button" aria-label="Toggle light/dark mode" title="Toggle light/dark mode">
				<span class="theme-toggle-icon">üåô</span>
			</button>
			<a class="header-link" href="/">Overview</a>
			<a class="header-link" href="/pool">Pool</a>
			<a class="header-link" href="/node">Node</a>
			<a class="header-link" href="/server">Server</a>
			<a class="header-link worker-login-link" href="/worker">Worker login</a>
			<a class="header-link" href="https://github.com/Distortions81/M45-Core-goPool" target="_blank" rel="noopener noreferrer">GitHub</a>
			{{if .DiscordURL}}
			<a class="header-link discord-link" href="{{.DiscordURL}}" target="_blank" rel="noopener noreferrer">Discord</a>
			{{end}}
		</nav>
	</div>
</header>
{{range .Warnings}}
<div class="warning-banner">
	<span class="warning-title">Warning</span>
	<span class="warning-text">{{.}}</span>
</div>
{{end}}
{{end}}

{{define "footer"}}
<p class="text-sm" style="margin-top:8px;color:#646b86;">
	<span class="mono">{{.PoolSoftware}}</span>
	&mdash; build: <span class="mono">{{.BuildTime}}</span>
</p>
<div class="text-sm" style="margin-top:4px;color:#646b86;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;">
	{{if .PoolDonationAddress}}
	<div>
		Donate to this pool:
		<a href="bitcoin:{{.PoolDonationAddress}}" class="code-box copyable" title="Click to copy or open in wallet" data-copy="{{.PoolDonationAddress}}" style="text-decoration:none;color:inherit;">{{.PoolDonationAddress}}</a>
	</div>
	{{end}}
	<div style="{{if not .PoolDonationAddress}}margin-left:auto;{{end}}">
		render: <span class="mono">{{formatRenderDuration .RenderDuration}}</span>
	</div>
</div>
<script>
// Theme switcher - maintains theme preference across page loads
(function() {
	const themeToggle = document.getElementById('themeToggle');
	const themeIcon = document.querySelector('.theme-toggle-icon');

	// Get saved theme or default to dark
	const savedTheme = localStorage.getItem('theme') || 'dark';

	// Apply theme on load
	function applyTheme(theme) {
		if (theme === 'light') {
			document.documentElement.setAttribute('data-theme', 'light');
			if (themeIcon) themeIcon.textContent = '‚òÄÔ∏è';
		} else {
			document.documentElement.removeAttribute('data-theme');
			if (themeIcon) themeIcon.textContent = 'üåô';
		}
	}

	// Initialize theme
	applyTheme(savedTheme);

	// Toggle theme on button click
	if (themeToggle) {
		themeToggle.addEventListener('click', function() {
			const currentTheme = document.documentElement.getAttribute('data-theme');
			const newTheme = currentTheme === 'light' ? 'dark' : 'light';

			applyTheme(newTheme);
			localStorage.setItem('theme', newTheme);
		});
	}
})();

// Copy-to-clipboard functionality for code boxes
document.addEventListener('click', function(e) {
	const copyable = e.target.closest('.copyable');
	if (!copyable) return;

	const text = copyable.dataset.copy || copyable.textContent;
	navigator.clipboard.writeText(text).then(function() {
		const original = copyable.style.background;
		copyable.style.background = 'var(--accent-soft)';
		setTimeout(function() {
			copyable.style.background = original;
		}, 200);
	}).catch(function(err) {
		console.error('Failed to copy:', err);
	});
});
</script>
{{end}}
