{{/* Worker login template */}}
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>{{if .BrandDomain}}{{.BrandDomain}}{{else}}{{.BrandName}}{{end}} Worker Login</title>
	<link rel="stylesheet" href="/style.css">
</head>
<body>
	{{template "header" .}}
	<div class="page">
		{{if .ClerkEnabled}}
		<div class="card">
			<h2>Login to track multiple workers</h2>
			{{if .ClerkUser}}
				<p class="text-sm">Signed in as <strong>{{.ClerkUser.DisplayName}}</strong></p>
				<div class="button-row">
					<a class="btn" href="/saved-workers">Manage saved workers</a>
					<a class="btn btn-secondary" href="/logout?redirect=/worker">Sign out</a>
				</div>
			{{else}}
				<p class="text-sm">Sign in with Google (powered by Clerk) to save names for quick access.</p>
				<a class="btn" href="{{.ClerkLoginURL}}">Sign in with Google</a>
			{{end}}
		</div>
		{{end}}
		<div class="card">
			<h2>Quick Worker Lookup</h2>
			<form method="get" action="/worker/sha256" id="workerLookupForm">
				<div class="label">Worker ID</div>
				<div class="input-row">
					<input class="input" type="text" id="workerInput">
					<input type="hidden" name="hash" id="workerHash">
					<button class="btn" type="submit">Search</button>
				</div>
				<p class="text-sm">Use the full wallet.worker-name from your miner.</p>
			</form>
			{{if .Error}}
				<p class="text-sm" style="color:#f88d8d; margin-top:10px;">{{.Error}}</p>
			{{end}}
		</div>

		{{template "footer" .}}
	</div>
	<script>
	// SHA256 implementation for client-side hashing
	async function sha256(str) {
		try {
			const buffer = new TextEncoder().encode(str);
			const hashBuffer = await crypto.subtle.digest('SHA-256', buffer);
			const hashArray = Array.from(new Uint8Array(hashBuffer));
			return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
		} catch (error) {
			console.error('SHA256 error:', error);
			alert('Error: Secure context (HTTPS) required for client-side hashing. Please contact the pool administrator.');
			throw error;
		}
	}

	// Handle worker lookup form submission
	document.getElementById('workerLookupForm').addEventListener('submit', async function(e) {
		e.preventDefault();
		const workerInput = document.getElementById('workerInput').value.trim();
		if (!workerInput) {
			alert('Please enter a worker name');
			return;
		}
		try {
			// Hash the worker name
			const hash = await sha256(workerInput);
			document.getElementById('workerHash').value = hash;
			// Submit the form
			this.submit();
		} catch (error) {
			console.error('Form submission error:', error);
		}
	});
	</script>
</body>
</html>
